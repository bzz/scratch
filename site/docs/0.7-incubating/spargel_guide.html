<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Apache Flink (incubating): Spargel Graph Processing API</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-lumen-custom.css">
    <link rel="stylesheet" href="css/syntax.css">
    <link rel="stylesheet" href="css/custom.css">
    <link href="css/main/main.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/codetabs.js"></script>
  </head>
  <body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="row">
      <div class="col-md-1 af-mobile-nav-bar">
	<a href="index.html" title="Home">
	  <img class="hidden-xs hidden-sm img-responsive"
	       src="img/logo.png" alt="Apache Flink Logo">
	</a>	
	<div class="row visible-xs">
	  <div class="col-xs-3">
	    <a href="index.html" title="Home">  
	      <img class="hidden-x hidden-sm img-responsive"
		   src="img/logo.png" alt="Apache Flink Logo">
	    </a>	
	  </div>
	  <div class="col-xs-5"></div>
	  <div class="col-xs-4">
	    <div class="af-mobile-btn">
	      <span class="glyphicon glyphicon-plus"></span>
	    </div>
	  </div>
	</div>
      </div>
      <!-- Navigation -->
      <div class="col-md-11">
	<div class="collapse navbar-collapse" id="navbar-collapse-1">
	  <ul class="nav navbar-nav">

	    <li>
	      <a href="index.html" class="">Documentation</a>
	    </li>

	    <li>
	      <a href="api/java/index.html">Javadoc</a>
	    </li>

	    <li>
	      <a href="api/scala/index.html#org.apache.flink.api.scala.package">Scaladoc</a>
	    </li>

	  </ul>
	</div>
      </div>
    </div>
  </div>
</nav>


    <div style="padding-top:120px" class="container">

      <div class="row">
        <div class="col-md-3">
          <ul>
  <li><a href="faq.html">FAQ</a></li>
  <li>Quickstart
    <ul>
      <li><a href="setup_quickstart.html">Setup</a></li>
      <li><a href="run_example_quickstart.html">Run Example</a></li>
      <li><a href="java_api_quickstart.html">Java API</a></li>
      <li><a href="scala_api_quickstart.html">Scala API</a></li>
    </ul>
  </li>

  <li>Setup &amp; Configuration
    <ul>
      <li><a href="local_setup.html">Local Setup</a></li>
      <li><a href="building.html">Build Flink</a></li>
      <li><a href="cluster_setup.html">Cluster Setup</a></li>
      <li><a href="yarn_setup.html">YARN Setup</a></li>
      <li><a href="config.html">Configuration</a></li>
    </ul>
  </li>

  <li>Programming Guides
    <ul>
      <li><a href="programming_guide.html">Programming Guide</a></li>
      <li><a href="dataset_transformations.html">DataSet Transformations</a></li>
      <li><a href="java8_programming_guide.html">Java 8 Programming Guide</a></li>
      <li><a href="streaming_guide.html">Streaming Guide</a></li>
      <li><a href="iterations.html">Iterations</a></li>
      <li><a href="spargel_guide.html">Spargel Graph API</a></li>
      <li><a href="hadoop_compatibility.html">Hadoop Compatibility</a></li>
    </ul>
  </li>

  <li>Examples
    <ul>
      <li><a href="examples.html">Bundled Examples</a></li>
      <li><a href="example_connectors.html">Connecting to other systems</a></li>
    </ul>
  </li>

  <li>Execution
    <ul>
      <li><a href="local_execution.html">Local/Debugging</a></li>
      <li><a href="cluster_execution.html">Cluster</a></li>
      <li><a href="cli.html">Command-Line Interface</a></li>
      <li><a href="web_client.html">Web Interface</a></li>
    </ul>
  </li>

  <li>Internals
    <ul>
      <li><a href="internal_overview.html">Overview</a></li>
    </ul>
  </li>
</ul>

        </div>  
        <div class="col-md-9">
          <h1>Spargel Graph Processing API</h1>
	  
          <ul id="markdown-toc">
  <li><a href="#spargel-api">Spargel API</a></li>
  <li><a href="#example-propagate-minimum-vertex-id-in-graph">Example: Propagate Minimum Vertex ID in Graph</a></li>
</ul>

<p>Spargel is our <a href="http://giraph.apache.org">Giraph</a> like <strong>graph processing</strong> Java API. It supports basic graph computations, which are run as a sequence of <a href="iterations.html#supersteps">supersteps</a>. Spargel and Giraph both implement the <a href="https://en.wikipedia.org/wiki/Bulk_Synchronous_Parallel">Bulk Synchronous Parallel (BSP)</a> programming model, propsed by Google’s <a href="http://googleresearch.blogspot.de/2009/06/large-scale-graph-computing-at-google.html">Pregel</a>.</p>

<p>The API provides a <strong>vertex-centric</strong> view on graph processing with two basic operations per superstep:</p>

<ol>
  <li><strong>Send messages</strong> to other vertices, and</li>
  <li><strong>Receive messages</strong> from other vertices and <strong>update own vertex state</strong>.</li>
</ol>

<p>This vertex-centric view makes it easy to express a large class of graph problems efficiently. We will list all <em>relevant interfaces</em> of the <strong>Spargel API</strong> to implement and walk through an <strong>example Spargel program</strong>.</p>

<h2 id="spargel-api">Spargel API</h2>

<p>The Spargel API is part of the <em>addons</em> Maven project. All relevant classes are located in the <em>org.apache.flink.spargel.java</em> package.</p>

<p>Add the following dependency to your <code>pom.xml</code> to use the Spargel.</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>flink-spargel<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.7.0-incubating<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>Extend <strong>VertexUpdateFunction&lt;</strong><em>VertexKeyType</em>, <em>VertexValueType</em>, <em>MessageType</em><strong>&gt;</strong> to implement your <em>custom vertex update logic</em>.</p>

<p>Extend <strong>MessagingFunction&lt;</strong><em>VertexKeyType</em>, <em>VertexValueType</em>, <em>MessageType</em>, <em>EdgeValueType</em><strong>&gt;</strong> to implement your <em>custom message logic</em>.</p>

<p>Create a <strong>SpargelIteration</strong> operator to include Spargel in your data flow.</p>

<h2 id="example-propagate-minimum-vertex-id-in-graph">Example: Propagate Minimum Vertex ID in Graph</h2>

<p>The Spargel operator <strong>SpargelIteration</strong> includes Spargel graph processing into your data flow. As usual, it can be combined with other operators like <em>map</em>, <em>reduce</em>, <em>join</em>, etc.</p>

<div class="highlight"><pre><code class="language-java"><span class="n">FileDataSource</span> <span class="n">vertices</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileDataSource</span><span class="o">(...);</span>
<span class="n">FileDataSource</span> <span class="n">edges</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileDataSource</span><span class="o">(...);</span>

<span class="n">SpargelIteration</span> <span class="n">iteration</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SpargelIteration</span><span class="o">(</span><span class="k">new</span> <span class="nf">MinMessager</span><span class="o">(),</span> <span class="k">new</span> <span class="nf">MinNeighborUpdater</span><span class="o">());</span>
<span class="n">iteration</span><span class="o">.</span><span class="na">setVertexInput</span><span class="o">(</span><span class="n">vertices</span><span class="o">);</span>
<span class="n">iteration</span><span class="o">.</span><span class="na">setEdgesInput</span><span class="o">(</span><span class="n">edges</span><span class="o">);</span>
<span class="n">iteration</span><span class="o">.</span><span class="na">setNumberOfIterations</span><span class="o">(</span><span class="n">maxIterations</span><span class="o">);</span>

<span class="n">FileDataSink</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileDataSink</span><span class="o">(...);</span>
<span class="n">result</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="n">iteration</span><span class="o">.</span><span class="na">getOutput</span><span class="o">());</span>

<span class="k">new</span> <span class="nf">Plan</span><span class="o">(</span><span class="n">result</span><span class="o">);</span></code></pre></div>

<p>Besides the <strong>program logic</strong> of vertex updates in <em>MinNeighborUpdater</em> and messages in <em>MinMessager</em>, you have to specify the <strong>initial vertex</strong> and <strong>edge input</strong>. Every vertex has a <strong>key</strong> and <strong>value</strong>. In each superstep, it <strong>receives messages</strong> from other vertices and updates its state:</p>

<ul>
  <li><strong>Vertex</strong> input: <strong>(id</strong>: <em>VertexKeyType</em>, <strong>value</strong>: <em>VertexValueType</em><strong>)</strong></li>
  <li><strong>Edge</strong> input: <strong>(source</strong>: <em>VertexKeyType</em>, <strong>target</strong>: <em>VertexKeyType</em>[, <strong>value</strong>: <em>EdgeValueType</em>])</li>
</ul>

<p>For our example, we set the vertex ID as both <em>id and value</em> (initial minimum) and <em>leave out the edge values</em> as we don’t need them:</p>

<p class="text-center">
    <img alt="Spargel Example Input" width="75%" src="img/spargel_example_input.png" />
</p>

<p>In order to <strong>propagate the minimum vertex ID</strong>, we iterate over all received messages (which contain the neighboring IDs) and update our value, if we found a new minimum:</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MinNeighborUpdater</span> <span class="kd">extends</span> <span class="n">VertexUpdateFunction</span><span class="o">&lt;</span><span class="n">IntValue</span><span class="o">,</span> <span class="n">IntValue</span><span class="o">,</span> <span class="n">IntValue</span><span class="o">&gt;</span> <span class="o">{</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="n">IntValue</span> <span class="n">id</span><span class="o">,</span> <span class="n">IntValue</span> <span class="n">currentMin</span><span class="o">,</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">IntValue</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">min</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>

		<span class="c1">// iterate over all received messages</span>
		<span class="k">while</span> <span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
			<span class="kt">int</span> <span class="n">next</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="na">next</span><span class="o">().</span><span class="na">getValue</span><span class="o">();</span>
			<span class="n">min</span> <span class="o">=</span> <span class="n">next</span> <span class="o">&lt;</span> <span class="n">min</span> <span class="o">?</span> <span class="n">next</span> <span class="o">:</span> <span class="n">min</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="c1">// update vertex value, if new minimum</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">min</span> <span class="o">&lt;</span> <span class="n">currentMin</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">setNewVertexValue</span><span class="o">(</span><span class="k">new</span> <span class="nf">IntValue</span><span class="o">(</span><span class="n">min</span><span class="o">));</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>The <strong>messages in each superstep</strong> consist of the <strong>current minimum ID</strong> seen by the vertex:</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MinMessager</span> <span class="kd">extends</span> <span class="n">MessagingFunction</span><span class="o">&lt;</span><span class="n">IntValue</span><span class="o">,</span> <span class="n">IntValue</span><span class="o">,</span> <span class="n">IntValue</span><span class="o">,</span> <span class="n">NullValue</span><span class="o">&gt;</span> <span class="o">{</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessages</span><span class="o">(</span><span class="n">IntValue</span> <span class="n">id</span><span class="o">,</span> <span class="n">IntValue</span> <span class="n">currentMin</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// send current minimum to neighbors</span>
		<span class="n">sendMessageToAllNeighbors</span><span class="o">(</span><span class="n">currentMin</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>The <strong>API-provided method</strong> <code>sendMessageToAllNeighbors(MessageType)</code> sends the message to all neighboring vertices. It is also possible to address specific vertices with <code>sendMessageTo(VertexKeyType, MessageType)</code>.</p>

<p>If the value of a vertex does not change during a superstep, it will <strong>not send</strong> any messages in the superstep. This allows to do incremental updates to the <strong>hot (changing) parts</strong> of the graph, while leaving <strong>cold (steady) parts</strong> untouched.</p>

<p>The computation <strong>terminates</strong> after a specified <em>maximum number of supersteps</em> <strong>-OR-</strong> the <em>vertex states stop changing</em>.</p>

<p class="text-center">
    <img alt="Spargel Example" width="75%" src="img/spargel_example.png" />
</p>

	  
        <!-- Disqus Area -->
          <div style="padding-top:30px" id="disqus_thread"></div>
      
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'stratosphere-eu'; // required: replace example with your forum shortname

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        </div>

        <div class="footer">
          
          <hr class="divider" />

<p><small>Apache Flink is an effort undergoing incubation at The Apache Software
Foundation (ASF), sponsored by the Apache Incubator PMC. Incubation is
required of all newly accepted projects until a further review indicates that
the infrastructure, communications, and decision making process have
stabilized in a manner consistent with other successful ASF projects. While
incubation status is not necessarily a reflection of the completeness or
stability of the code, it does indicate that the project has yet to be fully
endorsed by the ASF.</small></p>

<p><a href="http://incubator.apache.org/"><img src="/img/apache-incubator-logo.png" alt="Incubator Logo" /></a></p>

<p class="text-center"><a href="privacy-policy.html">Privacy Policy<a>
</a></a></p>

        </div>
      </div>
    </div>

    

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');

    </script>

  </body>
</html>
